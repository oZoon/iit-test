"use strict";!function(){const e=[];let t;const a="+7 (___) ___-__-__",n={phone:"",dateMin:"",dateMax:""};let s={name:"",text:"",phone:""},l={date:"",name:"",text:"",phone:""},i={dateMin:"",dateMax:"",phone:""};const o=e=>`+7 (${e.slice(0,3)}) ${e.slice(3,6)}-${e.slice(6,8)}-${e.slice(8,10)}`,r=e=>e<10?"0"+e:e,c=e=>{const t=new Date(1e3*e);return`${r(t.getDate())}.${r(t.getMonth()+1)}.${t.getFullYear()} ${r(t.getHours())}:${r(t.getMinutes())}`},d=(e,t=null)=>{const a=e.trim().split(" "),n=a[0]?a[0].split("."):[1,1,1970],s=a[1]&&a[1].includes(":")?a[1].split(":"):[0,0],l=new Date(n[2],n[1]-1,n[0],s[0],s[1]),i=+new Date(n[2],n[1]-1,n[0],s[0],s[1]),o=r(l.getDate()),c=r(l.getMonth()+1),d=l.getFullYear(),m=r(l.getHours()),u=r(l.getMinutes());return t&&"filter"==t?[`${o}.${c}.${d}`,i]:[`${o}.${c}.${d} ${m}:${u}`,i]},m=e=>{const t=e.split(" "),a=t[0]?t[0].split("."):[1,1,1970];return new Date(a[2],a[1]-1,a[0]).getFullYear()>1e3},u=()=>{let t=JSON.parse(JSON.stringify(e));return n.phone&&(t=t.filter(e=>e.phone==n.phone)),n.dateMin&&(t=t.filter(e=>e.date>d(n.dateMin,"filter")[1]/1e3)),n.dateMax&&(t=t.filter(e=>e.date<d(n.dateMax,"filter")[1]/1e3)),t},p=e=>`<input\n            class="${e.className} js-${e.className} js-to-remove"\n            type="text"\n            value="${e.value}"\n            onkeyup="onChangeInput('js-${e.className}', this.value)"\n            "autoComplete="off"\n            />`,j=e=>`<button\n            class="${e.className} js-${e.className} js-to-remove"\n            onclick="onBtnClick('js-${e.className}')"\n                >\n                ${e.innerText}\n                </button>`,b=e=>`<span class="${e.className} js-to-remove">${e.innerText}</span>`,h=e=>`<textarea\n            class="${e.className} js-${e.className} js-to-remove"\n            onkeyup="onChangeInput('js-${e.className}', this.value)"\n            >${e.value}</textarea>`,x=(e,t)=>{t.insertAdjacentHTML("beforeend",e)},N=e=>{e.forEach(e=>{document.querySelector(e).style.display="none"})},f=()=>{e.sort((e,t)=>e.date>t.date?1:e.date<t.date?-1:0)},w=(e,t=null)=>{const a={};return COLUMNS.forEach(n=>{switch(n.type){case"date":"new"==e&&(a[n.colName]=parseInt(+Date.now()/1e3)),"init"==e&&(a[n.colName]=+new Date(1614240400+parseInt(86400*Math.random()*6)));break;case"string":if("new"==e&&(a[n.colName]=t[n.colName]),"init"==e){const e=parseInt(Math.random()*todo.length);a[n.colName]="name"==n.colName?todo[e]:tasks[e][parseInt(Math.random()*tasks[e].length)]}break;case"phone":"new"==e&&(a[n.colName]=t[n.colName]),"init"==e&&(a[n.colName]=`9${Array(9).fill("").map(()=>parseInt(10*Math.random())).join("")}`);break;case"id":a[n.colName]=(e=>{const t="qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM".split("");return Array(e).fill("").map(()=>t[Math.floor(Math.random()*t.length)]).join("")})(10)}}),a},k=(e,t)=>`<tr class="row-data js-to-remove">${COLUMNS.map(a=>{let n;switch(a.colName){case"date":n=c(t[e][a.colName]);break;case"actions":n=`<span class="edit" onClick="onEditRecord('${t[e][a.colName]}')">редактировать</span> | <span class="delete" onClick="onDeleteRecord('${t[e][a.colName]}')">удалить</span>`;break;case"phone":n=o(t[e][a.colName]);break;case"name":case"text":n=t[e][a.colName];break;case"order":n=e+1}return`<td>${n}</td>`}).join("")}</tr>`,y=e=>{for(let t of e)t.remove()},v=()=>{for(let e=0;e<t.length;e++)document.querySelector(".js-tbody").insertAdjacentHTML("beforeend",k(e,t))},M=()=>{document.querySelector(".js-thead").insertAdjacentHTML("afterbegin",`<tr>${COLUMNS.map(e=>`<td class="head-${e.colName}">${e.name}</td>`).join("")}</tr>`),t=u(),y(document.querySelectorAll(".js-to-remove")),v()};window.onBtnClick=(a=>{switch(a){case"js-btn-new-save":e.push(w("new",s)),f(),t=u(),y(document.querySelectorAll(".js-to-remove")),v(),N([".js-add-modal"]);break;case"js-btn-new-cancel":case"js-btn-new-close":s={},f(),t=u(),y(document.querySelectorAll(".js-to-remove")),v(),N([".js-add-modal"]);break;case"js-btn-edit-save":l.date=parseInt(d(l.date)[1]/1e3),e[e.findIndex(e=>e.actions==l.actions)]=l,f(),t=u(),y(document.querySelectorAll(".js-to-remove")),v(),N([".js-edit-modal"]);break;case"js-btn-edit-cancel":case"js-btn-edit-close":l={},f(),t=u(),y(document.querySelectorAll(".js-to-remove")),v(),N([".js-edit-modal"]);break;case"js-btn-filter-find":n.phone=i.phone,n.dateMin=i.dateMin.trim(),n.dateMax=i.dateMax.trim(),t=u(),y(document.querySelectorAll(".js-to-remove")),v(),N([".js-filter-modal"]);break;case"js-btn-filter-drop":n.phone="",n.dateMin="",n.dateMax="",t=u(),y(document.querySelectorAll(".js-to-remove")),v(),N([".js-filter-modal"]);break;case"js-btn-filter-close":y(document.querySelectorAll(".js-to-remove")),v(),N([".js-filter-modal"])}});const $=(e,t=null)=>{const a=[!0,!0,!0,!0,!0,!0],n=Object.keys(e);for(let s=0;s<n.length;s++){switch(n[s]){case"date":a[0]=e[n[s]]==d(e[n[s]])[0]&&m(e[n[s]]);break;case"name":a[1]=Boolean(e[n[s]].length);break;case"text":a[2]=Boolean(e[n[s]].length);break;case"phone":a[3]=t&&"filter"==t?10==e[n[s]].length||0==e[n[s]].length:10==e[n[s]].length;break;case"dateMin":a[4]=(e[n[s]].trim()==d(e[n[s]],"filter")[0]||0==e[n[s]].trim().length)&&m(e[n[s]]);break;case"dateMax":a[5]=(e[n[s]].trim()==d(e[n[s]],"filter")[0]||0==e[n[s]].trim().length)&&m(e[n[s]])}if(a.includes(!1))return!1}return!0};window.onChangeInput=((e,t)=>{const a=e.split("-");a.includes("new")&&((e,t)=>{switch(e){case"js-input-new-name":s.name=t;break;case"js-textarea-new-text":s.text=t;break;case"js-input-new-phone":s.phone=t.replaceAll(/[^0-9]+/g,"").substring(1)}$(s)?document.querySelector(".js-btn-new-save").disabled=!1:document.querySelector(".js-btn-new-save").disabled=!0})(e,t),a.includes("edit")&&((e,t)=>{switch(e){case"js-input-edit-date":l.date=t;break;case"js-input-edit-name":l.name=t;break;case"js-input-edit-text":l.text=t;break;case"js-input-edit-phone":l.phone=t.replaceAll(/[^0-9]+/g,"").substring(1)}$(l)?document.querySelector(".js-btn-edit-save").disabled=!1:document.querySelector(".js-btn-edit-save").disabled=!0})(e,t),a.includes("filter")&&((e,t)=>{switch(e){case"js-input-filter-date-min":i.dateMin=t;break;case"js-input-filter-date-max":i.dateMax=t;break;case"js-input-filter-phone":i.phone=t.replaceAll(/[^0-9]+/g,"").substring(1)}$(i,"filter")?document.querySelector(".js-btn-filter-find").disabled=!1:document.querySelector(".js-btn-filter-find").disabled=!0})(e,t)}),window.initTable=(()=>{N([".js-add-modal",".js-filter-modal",".js-edit-modal"]),(()=>{for(let t=0;t<5;t++)e.push(w("init"));f()})(),M()}),window.onEditRecord=(t=>{l=JSON.parse(JSON.stringify(e.find(e=>e.actions==t)));const n=document.querySelector(".js-edit-modal");x(p({className:"input-edit-date",value:c(l.date)}),n),x(p({className:"input-edit-name",value:l.name}),n),x(h({className:"textarea-edit-text",value:l.text}),n),x(p({className:"input-edit-phone",value:o(l.phone)}),n),l.date=c(l.date),x(j({className:"btn-edit-save",innerText:"СОХРАНИТЬ"}),n),x(j({className:"btn-edit-cancel",innerText:"ОТМЕНА"}),n),x(j({className:"btn-edit-close",innerText:"X"}),n),x(b({className:"text-edit-date",innerText:"дата создания"}),n),x(b({className:"text-edit-name",innerText:"название заявки"}),n),x(b({className:"text-edit-text",innerText:"текст заявки"}),n),x(b({className:"text-edit-phone",innerText:"телефон"}),n),n.style.display="block",window.maskPhone(".js-input-edit-phone",a),window.maskDateTime(".js-input-edit-date")}),window.onDeleteRecord=(a=>{e.splice(e.findIndex(e=>e.actions==a),1),f(),t=u(),y(document.querySelectorAll(".js-to-remove")),v()}),window.onNewRecord=(()=>{const e=document.querySelector(".js-add-modal");x(b({className:"text-new-title",innerText:"добавление новой записи"}),e),x(b({className:"text-new-name",innerText:"название заявки"}),e),x(b({className:"text-new-text",innerText:"текст заявки"}),e),x(b({className:"text-new-phone",innerText:"номер телефона"}),e),x(p({className:"input-new-name",value:""}),e),x(h({className:"textarea-new-text",value:""}),e),x(p({className:"input-new-phone",value:""}),e),x(j({className:"btn-new-save",innerText:"СОХРАНИТЬ"}),e),x(j({className:"btn-new-cancel",innerText:"ОТМЕНА"}),e),x(j({className:"btn-new-close",innerText:"X"}),e),document.querySelector(".js-btn-new-save").disabled=!0,window.maskPhone(".js-input-new-phone",a),e.style.display="block"}),window.onFilterRecords=(()=>{const e=document.querySelector(".js-filter-modal");i=JSON.parse(JSON.stringify(n)),x(b({className:"text-filter-title",innerText:"фильтры"}),e),x(b({className:"text-filter-phone",innerText:"номер телефона"}),e),x(b({className:"text-filter-date",innerText:"дата создания заявки"}),e),x(b({className:"text-filter-date-from",innerText:"от"}),e),x(b({className:"text-filter-date-to",innerText:"до"}),e),l.date=c(l.date),x(p({className:"input-filter-date-min",value:i.dateMin?i.dateMin:""}),e),x(p({className:"input-filter-date-max",value:i.dateMax?i.dateMax:""}),e),x(p({className:"input-filter-phone",value:i.phone?i.phone:""}),e),x(j({className:"btn-filter-find",innerText:"НАЙТИ"}),e),x(j({className:"btn-filter-drop",innerText:"СБРОСИТЬ"}),e),x(j({className:"btn-filter-close",innerText:"X"}),e),e.style.display="block",window.maskPhone(".js-input-filter-phone",a),window.maskDateTime(".js-input-filter-date-min"),window.maskDateTime(".js-input-filter-date-max")})}(),initTable();
